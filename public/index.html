<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat App</title>
  </head>
  <body>
    <h1>Chatting</h1>
    <input type="text" id="username" placeholder="Enter Name" />
    <input type="text" id="message" placeholder="Enter Message" />
    <button id="sendBtn">Send</button>
    <button onclick="resetMsgs()">Reset</button>

    <div id="messages"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const sendBtn = document.getElementById("sendBtn");
      const msgInput = document.getElementById("message");
      const usernameInput = document.getElementById("username");
      const allMessages = document.getElementById("messages");

      let messageStore = [];

      function generateRandomName() {
        const prefixes = [
          "Pixel",
          "Byte",
          "Flare",
          "Cyber",
          "Quantum",
          "Tech",
          "Hex",
          "Nova",
          "Vortex",
          "Neon",
        ];
        const suffixes = ["X", "Z", "42", "A7", "9", "0", "Q", "3D", "F", "R"];
        const randomPrefix =
          prefixes[Math.floor(Math.random() * prefixes.length)];
        const randomSuffix =
          suffixes[Math.floor(Math.random() * suffixes.length)];

        return `${randomPrefix}-${randomSuffix}`;
      }

      const genName = generateRandomName();

      function renderMsgs() {
        allMessages.innerHTML = "";
        messageStore.forEach((msg) => {
          const p = document.createElement("p");
          p.innerHTML = `<strong>${msg.sender}</strong> (${msg.timestamp}): ${msg.text}`;
          allMessages.appendChild(p);
        });
      }

      socket.on("message", (message) => {
        console.log(message);
        messageStore.push(message);
        renderMsgs();
      });

      socket.on("reset", () => {
        messageStore = [];
        renderMsgs();
        window.location.reload();
      });

      sendBtn.addEventListener("click", (e) => {
        const message = msgInput.value;
        const sender = usernameInput.value || genName;
        const timestamp = new Date().toLocaleString();
        if (message.trim()) {
          console.log(message);
          socket.emit("user-message", {
            text: message,
            sender: sender,
            timestamp: timestamp,
          });
          msgInput.value = "";
        }
      });

      function resetMsgs() {
        socket.emit("reset");
        messageStore = [];
        renderMsgs();
      }
    </script>
  </body>
</html>
